<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-md-8">

      <% if !@bookings_confirmed.first.nil? %>
      <h1><%= pluralize @bookings_confirmed.count, "dossier confirmé" %></h1>
        <% @bookings_confirmed.each do |booking| %>
          <div class="card-booking" id="<%= booking.id %>">
            <%= image_tag set_user_photo(booking.tenant), class: "card-booking-user avatar" %>
            <div class="card-booking-content">
              <div><%= set_fullname(booking.tenant) %></div>
              <div><%= booking.tenant.status %></div>
              <div>Status du dossier : <%= booking.status %></div>
              <div>Note du dossier : <%= render 'grade', booking: booking %></div>
            </div>
            <a class="card-booking-link" data-toggle="modal" data-target=".bs-example-modal-lg"></a>
            <%= render 'modal', booking: booking  %>
          </div>
        <% end %>
      <% end %>

      <% if !@bookings_pending.first.nil? %>
      <h1><%= pluralize @bookings_pending.count, "dossier" %> en attente</h1>
        <% @bookings_pending.each do |booking| %>
          <div class="card-booking" id="<%= booking.id %>">
            <%= image_tag set_user_photo(booking.tenant), class: "card-booking-user avatar" %>
            <div class="card-booking-content">
              <div><%= set_fullname(booking.tenant) %></div>
              <div><%= booking.tenant.status %></div>
              <div>Status du dossier : <%= booking.status %></div>
              <div>Note du dossier : <%= render 'grade', booking: booking %></div>
            </div>
            <a class="card-booking-link" data-toggle="modal" data-target=".bs-example-modal-lg"></a>
            <%= render 'modal', booking: booking %>
          </div>
        <% end %>
      <% end %>

      <% if !@bookings_cancelled.first.nil? %>
      <h1><%= pluralize @bookings_cancelled.count, "dossier annulé" %></h1>
        <% @bookings_cancelled.each do |booking| %>
          <div class="card-booking" id="<%= booking.id %>">
            <%= image_tag set_user_photo(booking.tenant), class: "card-booking-user avatar" %>
            <div class="card-booking-content">
              <div><%= set_fullname(booking.tenant) %></div>
              <div><%= booking.tenant.status %></div>
              <div>Status du dossier : <%= booking.status %></div>
              <div>Note du dossier : <%= render 'grade', booking: booking %></div>
            </div>
            <a class="card-booking-link" data-toggle="modal" data-target=".bs-example-modal-lg"></a>
            <%= render 'modal', booking: booking %>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="col-xs-12 col-md-4" id="criteres">
      <h1 class="text-center">Critères de sélection</h1>
      <div class="text-center">

        <%= simple_form_for @flat, method: 'patch', url: flat_filter_path(@flat), remote: true do |f| %>

          <%= f.label :income_ratio, "Ratio minimum Salaire du locataire / Loyer :", class: "control-label" %>

          <%= f.input :income_ratio, label: false, class: "form-control", input_html: {value: @flat.income_ratio, min: '1', max: '10', step: '0.1' } %>

          <div class="hidden" id="rent"><%= @flat.rent + @flat.rental_costs %></div>
          <div>Salaire minimun :</div>
          <div id="income"><%= (@flat.income_ratio * (@flat.rent + @flat.rental_costs)).round(0) %> €</div>

          <%= f.input :has_warrantor, label: "Garant",
          :collection => [[true, 'Oui'], [false, 'Non']],
          :label_method => :last,
          :value_method => :first,
          :as => :radio_buttons,
          :item_wrapper_class => 'inline',
          :checked => @flat.has_warrantor %>

          <div class="hidden" id="warrantor-income-box">
            <%= f.input :warrantor_income_ratio, label: "Ratio minimum Salaire du garant / Loyer :", input_html: {value: @flat.warrantor_income_ratio, min: '1', max: '10', step: '0.1' } %>
            <div>Salaire minimun du garant :</div>
            <div id="warrantor-income"><%= @flat.warrantor_income_ratio * (@flat.rent + @flat.rental_costs) %> €</div>
          </div>

          <%= f.input :deposit, label: "Vous exigez une caution de :", input_html: {value: @flat.deposit, min: '0' , max: ((@flat.rent + @flat.rental_costs) * 2).to_s , step: '10' } %>

          <div id="message-modif"></div>

          <%= f.button :submit, "Enregistrer les modifications de vos critères", class:"btn btn-danger"%>
        <% end %>

      </div>
    </div>

  </div>
</div>

<%= content_for(:after_js) do %>
  <script>
    $(document).ready(function() {
      <% if @flat.has_warrantor %>
        $('#warrantor-income-box').removeClass('hidden');
      <% end %>
    });
  </script>
<% end %>
